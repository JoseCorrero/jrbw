---
import ConcertCard from './CardConcert.astro';
import { type Concert } from '../types/concert';

import concertsJson from '../../data/concerts.json';

const concerts = (JSON.parse(JSON.stringify(concertsJson))) as Concert[];

const date = new Date();
const today = new Date(`${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`);

const next = concerts.filter(({ date }) => today <= new Date(date));
const old = concerts.filter(({ date }) => new Date(date) < today);
---

<div class="flex flex-col sm:max-w-xl lg:max-w-4xl px-4 m-auto items-center justify-center relative overflow-hidden">
    <div class="flex relative space-x-4 mb-8 pb-1 overflow-hidden">
        <button id="btnNextConcerts"
                class="relative px-4 py-2 text-white text-xl current-section">
            Next concerts
        </button>
        <button id="btnOldConcerts"
                class="relative px-4 py-2 text-white text-xl">
            Old concerts
        </button>

        <div id="bottonUnderlineContent" class="flex absolute w-full h-1 bottom-0 next-current-section">
            <div class="button-next-underline"></div>
            <div class="button-old-underline"></div>
        </div>
    </div>
    
    <div class="w-full h-full">
        <div id="concertsContent" class="concerts-content next-visible">
            <section class="concerts-section">
                <div class="w-full p-6">
                    <div class="grid gap-y-16">
                        {
                            next.map(concert =>
                                <article>
                                    <ConcertCard concert={concert} />
                                </article>
                            )
                        }
                    </div>
                </div>
            </section>

            <section class="concerts-section">
                <div class="w-full p-6">
                    <div class="grid gap-y-16">
                        {
                            old.map(concert =>
                                <article>
                                    <ConcertCard concert={concert} />
                                </article>
                            )
                        }
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="absolute inset-y-0 left-0 w-10 pointer-events-none bg-gradient-to-r from-[var(--background-color)]"></div>
    <div class="absolute inset-y-0 right-0 w-10 pointer-events-none bg-gradient-to-l from-[var(--background-color)]"></div>
</div>

<style>
    .current-section {
        color: var(--color-selected);
    }

    .button-next-underline,
    .button-old-underline {
        content: "";
        background: var(--color-selected);
        position: absolute;
        height: 3px;
    }

    .button-next-underline {
        width: 153px;
        left: -1em;
    }

    .button-old-underline {
        width: 143px;
        right: -9.75em;
    }

    .next-current-section {
        transform: translateX(0);
        transition: transform 0.25s ease-in-out;
    }

    .old-current-section {
        transform: translateX(-55%);
        transition: transform 0.25s ease-in-out;
    }

    .concerts-content {
        display: flex;
        width: 200%;
        height: 100%;
    }

    .concerts-section {
        width: 50%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
    }

    .next-visible {
        transform: translateX(0);
        transition: transform 0.25s ease-in-out;
    }

    .old-visible {
        transform: translateX(-50%);
        transition: transform 0.25s ease-in-out;
    }
</style>

<script is:inline>
    bottonUnderlineContent = document.getElementById('bottonUnderlineContent');
    btnNextConcerts = document.getElementById('btnNextConcerts');
    btnOldConcerts = document.getElementById('btnOldConcerts');
    concertsContent = document.getElementById('concertsContent');

    btnNextConcerts.addEventListener('click', () => {
        bottonUnderlineContent.classList.add('next-current-section');
        bottonUnderlineContent.classList.remove('old-current-section');

        btnNextConcerts.classList.add('current-section');
        btnOldConcerts.classList.remove('current-section');

        concertsContent.classList.add('next-visible');
        concertsContent.classList.remove('old-visible');
    });

    btnOldConcerts.addEventListener('click', () => {
        bottonUnderlineContent.classList.add('old-current-section');
        bottonUnderlineContent.classList.remove('next-current-section');

        btnOldConcerts.classList.add('current-section');
        btnNextConcerts.classList.remove('current-section');

        concertsContent.classList.add('old-visible');
        concertsContent.classList.remove('next-visible');
    });
</script>
